!function($,window,document){"use strict";function hexToRgb(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)]:null}function getPropVal(curShift,perShift,bottomRange,topRange){return Math.round(bottomRange+(topRange-bottomRange)*curShift/perShift)}function getCurrentColor(curPer,bottomVal,topVal,bottomColor,topColor){var rgbAryTop=topColor.indexOf("#")!=-1?hexToRgb(topColor):topColor.match(/\d+/g),rgbAryBottom=bottomColor.indexOf("#")!=-1?hexToRgb(bottomColor):bottomColor.match(/\d+/g),perShift=topVal-bottomVal,curShift=curPer-bottomVal;return rgbAryTop&&rgbAryBottom?"rgb("+getPropVal(curShift,perShift,rgbAryBottom[0],rgbAryTop[0])+","+getPropVal(curShift,perShift,rgbAryBottom[1],rgbAryTop[1])+","+getPropVal(curShift,perShift,rgbAryBottom[2],rgbAryTop[2])+")":null}function merge(){for(var arg=arguments,target=arg[0],i=1,ln=arg.length;i<ln;i++){var obj=arg[i];for(var k in obj)obj.hasOwnProperty(k)&&(target[k]=obj[k])}return target}function formatter(pattern){return function(num){if(!pattern)return num.toString();num=num||0;for(var numRev=num.toString().split("").reverse(),output=pattern.split("").reverse(),i=0,lastHashReplaced=0,ln=output.length;i<ln&&numRev.length;i++)"#"==output[i]&&(lastHashReplaced=i,output[i]=numRev.shift());return output.splice(lastHashReplaced+1,output.lastIndexOf("#")-lastHashReplaced,numRev.reverse().join("")),output.reverse().join("")}}function Indicator(container,indOption){indOption=indOption||{},indOption=merge({},radialIndicator.defaults,indOption),this.indOption=indOption,"string"==typeof container&&(container=document.querySelector(container)),container.length&&(container=container[0]),this.container=container;var canElm=document.createElement("canvas");container.appendChild(canElm),this.canElm=canElm,this.ctx=canElm.getContext("2d"),this.current_value=indOption.initValue||indOption.minValue||0}function radialIndicator(container,options){var progObj=new Indicator(container,options);return progObj.init(),progObj}var circ=2*Math.PI,quart=Math.PI/2;Indicator.prototype={constructor:radialIndicator,init:function(){var indOption=this.indOption,canElm=this.canElm,ctx=this.ctx,dim=2*(indOption.radius+indOption.barWidth),center=dim/2;return this.formatter="function"==typeof indOption.format?indOption.format:formatter(indOption.format),this.maxLength=indOption.percentage?4:this.formatter(indOption.maxValue).length,canElm.width=dim,canElm.height=dim,ctx.strokeStyle=indOption.barBgColor,ctx.lineWidth=indOption.barWidth,ctx.beginPath(),ctx.arc(center,center,indOption.radius,0,2*Math.PI),ctx.stroke(),this.imgData=ctx.getImageData(0,0,dim,dim),this.value(this.current_value),this},value:function(val){if(void 0===val||isNaN(val))return this.current_value;val=parseInt(val);var ctx=this.ctx,indOption=this.indOption,curColor=indOption.barColor,dim=2*(indOption.radius+indOption.barWidth),minVal=indOption.minValue,maxVal=indOption.maxValue,center=dim/2;val=val<minVal?minVal:val>maxVal?maxVal:val;var perVal=Math.round(100*(val-minVal)/(maxVal-minVal)*100)/100,dispVal=indOption.percentage?perVal+"%":this.formatter(val);if(this.current_value=val,ctx.putImageData(this.imgData,0,0),"object"==typeof curColor)for(var range=Object.keys(curColor),i=1,ln=range.length;i<ln;i++){var bottomVal=range[i-1],topVal=range[i],bottomColor=curColor[bottomVal],topColor=curColor[topVal],newColor=val==bottomVal?bottomColor:val==topVal?topColor:val>bottomVal&&val<topVal&&(indOption.interpolate?getCurrentColor(val,bottomVal,topVal,bottomColor,topColor):topColor);if(0!=newColor){curColor=newColor;break}}if(ctx.strokeStyle=curColor,indOption.roundCorner&&(ctx.lineCap="round"),ctx.beginPath(),ctx.arc(center,center,indOption.radius,-quart,circ*perVal/100-quart,!1),ctx.stroke(),indOption.displayNumber){var cFont=ctx.font.split(" "),weight=indOption.fontWeight,fontSize=indOption.fontSize||dim/(this.maxLength-(Math.floor(1.4*this.maxLength/4)-1));cFont=indOption.fontFamily||cFont[cFont.length-1],ctx.fillStyle=indOption.fontColor||curColor,ctx.font=weight+" "+fontSize+"px "+cFont,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(dispVal,center,center)}return this},animate:function(val){var indOption=this.indOption,counter=this.current_value||indOption.minValue,self=this,incBy=Math.ceil((indOption.maxValue-indOption.minValue)/(indOption.frameNum||(indOption.percentage?100:500))),back=val<counter;return this.intvFunc&&clearInterval(this.intvFunc),this.intvFunc=setInterval(function(){if(!back&&counter>=val||back&&counter<=val){if(self.current_value==counter)return void clearInterval(self.intvFunc);counter=val}self.value(counter),counter!=val&&(counter+=back?-incBy:incBy)},indOption.frameTime),this},option:function(key,val){return void 0===val?this.option[key]:(["radius","barWidth","barBgColor","format","maxValue","percentage"].indexOf(key)!=-1&&(this.indOption[key]=val,this.init().value(this.current_value)),void(this.indOption[key]=val))}},radialIndicator.defaults={radius:50,barWidth:5,barBgColor:"#eeeeee",barColor:"#99CC33",format:null,frameTime:10,frameNum:null,fontColor:null,fontFamily:null,fontWeight:"bold",fontSize:null,interpolate:!0,percentage:!1,displayNumber:!0,roundCorner:!1,minValue:0,maxValue:100,initValue:0},window.radialIndicator=radialIndicator,$&&($.fn.radialIndicator=function(options){return this.each(function(){var newPCObj=radialIndicator(this,options);$.data(this,"radialIndicator",newPCObj)})})}(window.jQuery,window,document,void 0);