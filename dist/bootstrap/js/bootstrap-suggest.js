!function(t){t.fn.bsSuggest=function(t){return"string"==typeof t&&e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void 0:e.init.apply(this,arguments)};var e={init:function(e){function i(t,e,i){e.is(":visible")||("left"===i.listAlign?e.css({left:t.siblings("div").width()-t.parent().width(),right:"auto"}):"right"===i.listAlign&&e.css({left:"auto",right:"0"}))}function n(t,e){var i,n,a;return-1===e.indexId&&!e.idField||e.multiWord?t:(i=t.css("background-color").replace(/ /g,"").split(",",3).join(","),n=e.inputBgColor||"rgba(255,255,255,0.1)",a=e.inputWarnColor||"rgba(255,255,0,0.1)",!t.val()||t.attr("data-id")?t.css("background",n):(-1===a.indexOf(i)&&(t.trigger("onUnsetSelectValue"),t.css("background",a)),t))}function a(t,e){var i,n,a=t.parent().find("tbody tr."+b.listHoverCSS);a.length>0&&(i=(a.index()+3)*a.height(),n=Number(e.css("max-height").replace("px","")),i>n||e.scrollTop()>n?e.scrollTop(i-n):e.scrollTop(0))}function o(t,e){t=t||$dropdownMenu,e=e||b,t.find("tr."+e.listHoverCSS).removeClass(e.listHoverCSS)}function r(e){var i=t(e),n=i.parent(".input-group").find("ul.dropdown-menu"),a=i.data("bsSuggest");return 0===n.length?!1:a?!1:(i.data("bsSuggest",{target:e,options:b}),!0)}function s(e,i,n,a){var o,r,s,l,f,h,p,g={value:[]};if(e=e||"",a=a||b,a.url)f=-1!==a.url.indexOf("?")?"&":"?",h=a.jsonp?[a.url+e,f,a.jsonp,"=?"].join(""):a.url+e,t.ajax({type:"GET",url:h,dataType:"json",timeout:3e3}).done(function(t){n(i,t,a),i.trigger("onDataRequestSuccess",t),"firstByUrl"===b.getDataMethod&&(b.data=t,b.url=null)}).fail(v);else{if(o=a.data,r=d(o))if(e){for(p=o.value.length,s=0;p>s;s++)for(l in o.value[s])if(t.trim(o.value[s][l])&&(c(l,a)||u(l,a))&&(-1!==o.value[s][l].toString().indexOf(e)||-1!==e.indexOf(o.value[s][l]))){g.value.push(o.value[s]);break}}else g=o;n(i,g,a)}}function l(t){return validData=d(t)}function d(t){var e=!0;for(var i in t)if("value"===i){e=!1;break}return e?(v("返回数据格式错误!"),!1):0===t.value.length?!1:t}function u(e,i){return i=i||b,!(t.isArray(i.effectiveFields)&&i.effectiveFields.length>0&&-1===t.inArray(e,i.effectiveFields))}function c(e,i){return-1!==t.inArray(e,i.searchFields)}function f(t,e,i){var n,a,o,r,s,d,c,f=t.parent().find("ul.dropdown-menu"),p=0,g=['<table class="table table-condensed">'];if(i=i||b,e=l(e),e===!1||0===(n=e.value.length))return f.empty().hide(),t;if(i.showHeader){r="<thead><tr>";for(o in e.value[0])u(o)!==!1&&(r+=0===p?"<th>"+(i.effectiveFieldsAlias[o]||o)+"("+n+")</th>":"<th>"+(i.effectiveFieldsAlias[o]||o)+"</th>",p++);r+="</tr></thead>",g.push(r)}for(g.push("<tbody>"),a=0;n>a;a++){p=0,s="",d=e.value[a][i.idField]||"",c=e.value[a][i.keyField]||"",sourValue=e.value[a];for(o in e.value[a])c||i.indexKey!==p||(c=e.value[a][o]),d||i.indexId!==p||(d=e.value[a][o]),p++,u(o)!==!1&&(s+='<td data-name="'+o+'">'+e.value[a][o]+"</td>");s='<tr data-index="'+a+'" data-id="'+d+'" data-key="'+c+"\" data-sour='"+JSON.stringify(sourValue)+"'>"+s+"</tr>",g.push(s)}return g.push("</tbody></table>"),f.html(g.join("")).show(),h(t,f,i),f.css("max-height")&&Number(f.css("max-height").replace("px",""))<Number(f.find("table:eq(0)").css("height").replace("px",""))&&Number(f.css("min-width").replace("px",""))<Number(f.css("width").replace("px",""))?f.css("padding-right","20px").find("table:eq(0)").css("margin-bottom","20px"):f.css("padding-right",0).find("table:eq(0)").css("margin-bottom",0),t}function h(e,i,a){i=i||$dropdownMenu,a=a||b,i.find("tbody tr").each(function(r){t(this).off("mouseenter").on("mouseenter",function(e){o(i,a),t(this).addClass(a.listHoverCSS)}).off("mousedown").on("mousedown",function(i){g(e,p(t(this)),a),n(e,a)})})}function p(t){var e={};return e.id=t.attr("data-id"),e.key=t.attr("data-key"),e.sour=t.data("sour"),e}function g(t,e,i){var n,a=e||{},o=a.id||"",r=a.key||"";i&&i.multiWord?(n=t.val().split(i.separator||" "),n[n.length-1]=r,t.val(n.join(i.separator||" ")).focus()):t.attr("data-id",o).focus().val(r),t.trigger("onSetSelectValue",a)}function v(t,e){console.trace(t),e&&console.trace(e)}var y=this,b=t.extend({url:null,jsonp:null,data:{},getDataMethod:"firstByUrl",indexId:0,indexKey:0,idField:"",keyField:"",effectiveFields:[],effectiveFieldsAlias:{},searchFields:[],showHeader:!1,showBtn:!0,allowNoKeyword:!0,multiWord:!1,separator:",",processData:l,getData:s,autoMinWidth:!1,listAlign:"left",inputBgColor:"",inputWarnColor:"rgba(255,0,0,.1)",listStyle:{"padding-top":0,"max-height":"375px","max-width":"800px",overflow:"auto",width:"auto",transition:"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"},listHoverStyle:"background: #07d; color:#fff",listHoverCSS:"jhover",keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13},e);return t.isFunction(b.processData)&&(l=b.processData),t.isFunction(b.getData)&&(s=b.getData),!e.showHeader&&b.effectiveFields&&b.effectiveFields.length>1&&(b.showHeader=!0),t("head:eq(0)").append("<style>."+b.listHoverCSS+"{"+b.listHoverStyle+"}</style>"),y.each(function(){var l=t(this),d=l.parents(".input-group:eq(0)").find("ul.dropdown-menu");return r(this)===!1?void console.warn("不是一个标准的 bootstrap 下拉式菜单:",this):(b.showBtn||l.css("border-radius","4px").parents(".input-group:eq(0)").css("width","100%").find(".input-group-btn>.btn").hide(),l.removeClass("disabled").attr("disabled",!1).attr("autocomplete","off"),d.css(b.listStyle),b.inputBgColor||(b.inputBgColor=l.css("background-color")),b.autoMinWidth===!1?d.css({"min-width":l.parent().width()}):d.css("width","auto"),l.on("keydown",function(e){var i,n="";"none"!==d.css("display")&&(i=d.find("."+b.listHoverCSS),n="",e.keyCode===b.keyDown?(0===i.length?n=p(d.find("table tbody tr:first").mouseover()):0===i.next().length?(o(d,b),t(this).val(t(this).attr("alt")).attr("data-id","")):(o(d,b),0!==i.next().length&&(n=p(i.next().mouseover()))),a(l,d)):e.keyCode===b.keyUp?(0===i.length?n=p(d.find("table tbody tr:last").mouseover()):0===i.prev().length?(o(d,b),t(this).val(t(this).attr("alt")).attr("data-id","")):(o(d,b),0!==i.prev().length&&(n=p(i.prev().mouseover()))),a(l,d)):e.keyCode===b.keyEnter?d.hide().empty():t(this).attr("data-id",""),n&&""!==n.key&&g(t(this),n,b))}).on("keyup",function(i){var a,o;return i.keyCode===b.keyDown||i.keyCode===b.keyUp||i.keyCode===b.keyEnter?(t(this).val(t(this).val()),void n(l,b)):(t(this).attr("data-id",""),n(l,b),a=t(this).val(),void(""!==t.trim(a)&&a===t(this).attr("alt")||(t(this).attr("alt",t(this).val()),e.multiWord&&(o=a.split(b.separator||" "),a=o[o.length-1]),(0!==a.length||b.allowNoKeyword)&&s(t.trim(a),l,f,b))))}).on("focus",function(){i(l,d,b)}).on("blur",function(){d.css("display","")}).on("click",function(){var e,i=t(this).val();return""!==t.trim(i)&&i===t(this).attr("alt")&&d.find("table tr").length?d.show():void("none"===d.css("display")&&(b.multiWord&&(e=i.split(b.separator||" "),i=e[e.length-1]),(0!==i.length||b.allowNoKeyword)&&s(t.trim(i),l,f,b)))}),l.parent().find("button:eq(0)").attr("data-toggle","").on("click",function(){var t;"none"===d.css("display")?(t="block",b.url?l.click().focus():(f(l,b.data,b),i(l,d,b))):t="none",d.css("display",t)}),void d.on("mouseenter",function(){t(this).show()}).on("mouseleave",function(){l.focus()}))})},show:function(){var t=this.data("bsSuggest");return t&&t.options&&this.parent().find("ul.dropdown-menu").show(),this},hide:function(){var t=this.data("bsSuggest");return t&&t.options&&this.parent().find("ul.dropdown-menu").css("display",""),this},disable:function(e){return t(this).data("bsSuggest")?void t(this).attr("disabled",!0).parent().find(".input-group-btn>.btn").addClass("disabled"):!1},enable:function(){return t(this).data("bsSuggest")?void t(this).attr("disabled",!1).parent().find(".input-group-btn>.btn").removeClass("disabled"):!1},destroy:function(){t(this).off().removeData("bsSuggest").parent().find(".input-group-btn>.btn").off()}}}(window.jQuery);